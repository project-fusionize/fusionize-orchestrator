kind: Workflow
apiVersion: v1
name: Test Email Workflow
domain: test.emailWorkflow
key: test-email-workflow-key
description: A test workflow for email processing
version: 1
active: true
nodes:
  start:
    type: START
    component: start:test.receivedIncomingEmail
    componentConfig:
      address: incoming@email.com
    next: [outgoing1, outgoing2, outgoing3]

  outgoing1:
    type: TASK
    component: task:test.sendEmail
    componentConfig:
      address: outgoing1@email.com
    next: [waiting1 ]

  outgoing2:
    type: TASK
    component: task:test.sendEmail
    componentConfig:
      address: outgoing2@email.com
    next: [waiting2 ]

  outgoing3:
    type: TASK
    component: task:test.sendEmail
    componentConfig:
      address: outgoing3@email.com
    next: [ waiting3 ]

  waiting1:
    type: WAIT
    component: delay
    componentConfig:
      delay: 120
    next: [ waitFor123 ]

  waiting2:
    type: WAIT
    component: delay
    componentConfig:
      delay: 230
    next: [ waitFor123 ]

  waiting3:
    type: WAIT
    component: delay
    componentConfig:
      delay: 300
    next: [ waitFor123 ]

  waitFor123:
    type: WAIT
    component: join
    componentConfig:
      mergeStrategy: pickLast
      await: [waiting1, waiting2, waiting3]
    next: [ end ]

  end:
    type: END
    component: end:test.endEmailWorkflow
    next: []
